<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Walton Market - Admin</title>
<link rel="icon" href="https://back.wltnmarket.com/storage/images/logo/dark.png?0.609100662293576" type="image/png">
<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:'Montserrat',sans-serif;}
  body{background:linear-gradient(135deg,#0d1117,#1a1f2b);color:white;min-height:100vh;padding:20px;}
  header{display:flex;align-items:center;margin-bottom:20px;}
  header img{height:60px;margin-right:15px;}
  h1{font-size:1.8rem;}
  table{width:100%;border-collapse:collapse;margin-top:20px;}
  th, td{padding:12px 15px;border:1px solid rgba(255,255,255,0.2);text-align:left;}
  th{background:rgba(255,255,255,0.1);}
  tr:nth-child(even){background:rgba(255,255,255,0.05);}
  tr:hover{background:rgba(255,110,196,0.2);}
  #loginForm{max-width:400px;margin:auto;text-align:center;}
  #loginForm input{width:100%;padding:12px 15px;margin-bottom:15px;border-radius:10px;border:none;font-size:1rem;}
  #loginForm button{padding:12px 30px;font-size:1.2rem;color:white;background:linear-gradient(45deg,#ff6ec4,#7873f5);border:none;border-radius:50px;cursor:pointer;transition:0.3s;box-shadow:0 5px 25px rgba(0,0,0,0.6);}
  #loginForm button:hover{transform:scale(1.05);box-shadow:0 10px 35px rgba(0,0,0,0.8);}
</style>
</head>
<body>

<header>
  <img src="https://back.wltnmarket.com/storage/images/logo/dark.png?0.609100662293576" alt="Walton Market Logo">
  <h1>Admin Panel</h1>
</header>

<!-- Login -->
<div id="loginDiv">
  <form id="loginForm">
    <input type="text" id="login" placeholder="Login" required>
    <input type="password" id="password" placeholder="Password" required>
    <button type="submit">Accedi</button>
  </form>
</div>

<!-- Таблиця користувачів -->
<div id="adminTable" style="display:none;">
  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Cognome</th>
        <th>Email</th>
        <th>Prefisso</th>
        <th>Telefono</th>
        <th>Obiettivo</th>
        <th>Esperienza</th>
        <th>Data</th>
      </tr>
    </thead>
    <tbody id="userTable">
      <!-- Дані підтягуються сюди -->
    </tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const loginForm = document.getElementById('loginForm');
  const loginDiv = document.getElementById('loginDiv');
  const adminTable = document.getElementById('adminTable');
  const userTable = document.getElementById('userTable');

  const ADMIN_LOGIN = 'admin138';
  const ADMIN_PASSWORD = 'admin2025';

  // Supabase client
  const supabaseUrl = 'https://geazefwmcocuotixqlyf.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdlYXplZndtY29jdW90aXhxbHlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MTg3MTYsImV4cCI6MjA3NTQ5NDcxNn0.r0jfc5EITj47Hve-IuSYABfTDz4_-_5j76AYrpptf68';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  loginForm.addEventListener('submit', async function(e){
    e.preventDefault();
    const loginValue = document.getElementById('login').value;
    const passwordValue = document.getElementById('password').value;

    if(loginValue === ADMIN_LOGIN && passwordValue === ADMIN_PASSWORD){
      loginDiv.style.display='none';
      adminTable.style.display='block';
      await loadUsers();
    } else {
      alert('Login o password errati!');
    }
  });

  async function loadUsers(){
    const { data: users, error } = await supabase.from('users').select('*').order('date', { ascending: false });
    userTable.innerHTML = '';
    if(error){
      console.error('Supabase error:', error);
      const tr = document.createElement('tr');
      const td = document.createElement('td');
      td.colSpan = 8;
      td.textContent = 'Errore nel caricamento dati';
      td.style.textAlign = 'center';
      tr.appendChild(td);
      userTable.appendChild(tr);
      return;
    }

    if(users.length === 0){
      const tr = document.createElement('tr');
      const td = document.createElement('td');
      td.colSpan = 8;
      td.textContent = 'Nessun utente registrato';
      td.style.textAlign = 'center';
      tr.appendChild(td);
      userTable.appendChild(tr);
    } else {
      users.forEach(user => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${user.firstName}</td>
          <td>${user.lastName}</td>
          <td>${user.email}</td>
          <td>${user.prefix}</td>
          <td>${user.phone}</td>
          <td>${user.goal || ''}</td>
          <td>${user.experience || ''}</td>
          <td>${user.date}</td>
        `;
        userTable.appendChild(tr);
      });
    }
  }
</script>

</body>
</html>
