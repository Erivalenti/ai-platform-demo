<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Walton Market - Admin</title>
  <link href="https://as1.ftcdn.net/jpg/00/07/32/48/1000_F_7324855_mx4CEBWTr81XLOrlQccCROtP2uNR7xbk.jpg">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<header>
  <img src="https://back.wltnmarket.com/storage/images/logo/dark.png?0.609100662293576" alt="Walton Market Logo">
  <h1>Admin Panel</h1>
</header>

<!-- üîê Login -->
<div id="loginDiv">
  <form id="loginForm">
    <input type="text" id="login" placeholder="Login" required>
    <input type="password" id="password" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>
</div>

<!-- üìã Users table -->
<div id="adminTable" style="display:none;">
  <table>
    <thead>
      <tr>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Email</th>
        <th>Prefix</th>
        <th>Phone</th>
        <th>Goal</th>
        <th>Experience</th>
        <th>Salary</th>
        <th>Deposit</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody id="userTable">
      <!-- Users will appear here -->
    </tbody>
  </table>
</div>

<!-- ‚úÖ Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
<script src="js/env.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    console.log("Admin panel loaded");

    const ADMIN_LOGIN = "admin138";
    const ADMIN_PASSWORD = "admin2025";

    if (!window.__env) {
      console.error("window.__env not found. Please create js/env.js");
      return;
    }

    const supabaseUrl = window.__env.SUPABASE_URL;
    const supabaseAnonKey = window.__env.SUPABASE_ANON_KEY;
    const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

    const loginForm = document.getElementById("loginForm");
    const loginDiv = document.getElementById("loginDiv");
    const adminTable = document.getElementById("adminTable");
    const userTable = document.getElementById("userTable");

    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const login = document.getElementById("login").value.trim();
      const password = document.getElementById("password").value.trim();

      if (login === ADMIN_LOGIN && password === ADMIN_PASSWORD) {
        loginDiv.style.display = "none";
        adminTable.style.display = "block";
        await loadUsers();
      } else {
        alert("‚ùå Invalid login or password!");
      }
    });

    async function loadUsers() {
      userTable.innerHTML = "";

      const { data: users, error } = await supabase.from("users").select("*");

      if (error) {
        console.error("Supabase error:", error);
        userTable.innerHTML = `<tr><td colspan="10" style="text-align:center;">Error loading users</td></tr>`;
        return;
      }

      if (!users || users.length === 0) {
        userTable.innerHTML = `<tr><td colspan="10" style="text-align:center;">No users found</td></tr>`;
        return;
      }

      users.forEach((user) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${user.first_name || ""}</td>
          <td>${user.last_name || ""}</td>
          <td>${user.email || ""}</td>
          <td>${user.prefix || ""}</td>
          <td>${user.phone || ""}</td>
          <td>${user.goal || ""}</td>
          <td>${user.experience || ""}</td>
          <td>${user.salary || ""}</td>
          <td>${user.deposit || ""}</td>
          <td>${user.date || ""}</td>
        `;
        userTable.appendChild(tr);
      });
    }
  });
</script>

</body>
</html>
